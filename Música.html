<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√öSICA</title>
    <link rel="stylesheet" href="css/General.css">
    <link rel="stylesheet" href="css/Reproductor_Audio.css">
    <link rel="stylesheet" href="css/Cancion.css">
    <link rel="stylesheet" href="css/Archivo.css">
    <link rel="stylesheet" href="css/Navegador.css">
    <link rel="stylesheet" href="css/Configuracion.css">

    <link rel="stylesheet" href="css/Lista/CrearLista.css">
    <link rel="stylesheet" href="css/Lista/Cancion.css">
    <link rel="stylesheet" href="css/Lista/Reproductor_Audio.css">
    
    <script src="js/General.js" defer></script>
    <script src="js/Paginaci√≥n.js" defer></script>
    <script src="js/Botones.js" defer></script>
    <script src="js/Archivo.js" defer></script>
    <script src="js/Configuarcion.js" defer></script>
    <script src="js/Navegador.js" defer></script>

    <script src="js/Lista/CrearLista.js" defer></script>
    <script src="js/Lista/General.js" defer></script>
    <script src="js/Lista/Botones.js" defer></script>
    <script src="js/Lista/Paginaci√≥n.js" defer></script>

    <link rel="icon" type="image/png" href="img/Nota.png">
</head>
<body>
    <div class="divSpaceBetween">
        <div>
            <button class="btnBarraSuperior" onclick="mostrarSubirArchivo()">Subir Audios</button>
            <button class="btnBarraSuperior" onclick="mostrarCrearLista()">Lista</button>
            <button class="btnBarraSuperior" onclick="mostrarConfiguaracion()">Configuraci√≥n</button>
        </div>
        <button class="btnBarraSuperior" id="btnLista" onclick="OcultarCancionLista()">Cerrar</button>
        <button class="btnBarraSuperior" id="btnBusqueda" onclick="mostrarNavegador()">üîç</button>
    </div>
    <h1>M√öSICA</h1>
    <div id="containerAudio">
        <div id="reproduccion">
            <div>
                <h2 id="tituloAudio">[T√çTULO]</h2>
            </div>
            <div>
                <audio controls id="audio"><source src=""></audio>
            </div>
            <div id="div_btn">
                <button title="Reiniciar" onclick="audioReiniciar()" class="btn_controls">‚Ü©Ô∏é</button>
                <button title="Bucle" onclick="audioBucle()" id="btn_Bucle" class="btn_controls">‚Üª</button>
                <button title="Pausar" onclick="audioPlay()" id="btn_Play" class="btn_controls">‚ñ∂</button>
                <button title="Activar Continuar" onclick="audioContinue()" id="btn_Continuar" class="btn_controls">‚û§</button>
            </div>
            <div id="infoAudio">
                <span id="numeroCancion">0</span> / <span id="paginaCancion">0</span>
            </div>
        </div>

        <div id="containerBotones">
            <div id="btn_botones">
                <button onclick="reproducirAudio(0)" class="btn_musica"></button>
            </div>

            <div id="cambioCacnion">
                <button title="Anterior Canci√≥n" class="btn_controls" onclick="cambiarAudio(1)">‚èÆ</button>
                <button title="Siguiente Canci√≥n" class="btn_controls" onclick="cambiarAudio(2)">‚è≠</button>
            </div>
            
            <div id="paginacion">
                <button title="Anterior Pag√≠na" class="btn_controls" onclick="paginaci√≥n(0)">‚≠Ö</button>
                <div id="div_paginaActual"><span id="paginaActual">1</span></div>
                <button title="Proxima Pag√≠na" class="btn_controls" onclick="paginaci√≥n(1)">‚≠Ü</button>
            </div>
        </div>
    </div>
    <!-- Sistema Lista -->
    <div id="div_ocultar">
        <div id="containerAudioLista">
            <div id="reproduccionLista">
                <div>
                    <h2 id="tituloAudioLista">[T√çTULO]</h2>
                </div>
                <div>
                    <audio controls id="audioLista"><source src=""></audio>
                </div>
                <div id="div_btnLista">
                    <button title="Reiniciar" onclick="audioReiniciarLista()" class="btn_controls">‚Ü©Ô∏é</button>
                    <button title="Bucle" onclick="audioBucleLista()" id="btn_BucleLista" class="btn_controls">‚Üª</button>
                    <button title="Pausar" onclick="audioPlayLista()" id="btn_PlayLista" class="btn_controls">‚ñ∂</button>
                    <button title="Activar Continuar" onclick="audioContinueLista()" id="btn_ContinuarLista" class="btn_controls">‚û§</button>
                </div>
            </div>

            <div id="containerBotonesLista">
                <div id="btn_botonesLista">
                    <button onclick="reproducirAudio(0)" class="btn_musica"></button>
                </div>

                <div id="cambioCacnionLista">
                    <button title="Anterior Canci√≥n" class="btn_controls" onclick="cambiarAudioLista(1)">‚èÆ</button>
                    <button title="Siguiente Canci√≥n" class="btn_controls" onclick="cambiarAudioLista(2)">‚è≠</button>
                </div>
                
                <div id="paginacionLista">
                    <button title="Anterior Pag√≠na" class="btn_controls" onclick="paginaci√≥nLista(0)">‚≠Ö</button>
                    <div id="div_paginaActualLista"><span id="paginaActualLista">1</span></div>
                    <button title="Proxima Pag√≠na" class="btn_controls" onclick="paginaci√≥nLista(1)">‚≠Ü</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ventana para actualizar la m√∫sica -->
    <div id="ventanaArchivo">
        <div id="contenidoArchivo">
            <h2>Subir Audios desde Carpeta</h2>
            <button class="CuboBlanco" id="btn-cargar">Cargar audios</button>
            <input type="file" id="input-folder" webkitdirectory multiple hidden><br><br>
            <button class="CuboBlanco" onclick="ocultarSubirArchivo()">Cerrar</button>
        </div>
    </div>

    <!-- Ventana para crear lista de reproducci√≥n -->
    <div id="alertaCrearLista">
        <div id="contenidoCrearLista">
            <h2>Lista</h2>
            <div id="div_CrearLista">
                <div class="divsCrearLista" id="ListaCreadas">
                    <div id="ListasCreada">
                        <div class="divSpaceBetween">
                            <button onclick="CargarMusicaLista(0)">A</button>
                            <div>
                                <button onclick="EliminarLista(0)">üóë</button>
                                <button onclick="EditarLista(0)">‚öôÔ∏é</button>
                            </div>
                        </div>
                    </div>
                    <button class="CuboBlanco" style="margin-top: 7.5px;" onclick="NuevaLista()">+</button>
                </div>
                <div class="divsCrearLista" id="divBuscador">
                    <input type="search" id="buscadorLista" placeholder="Escribe para buscar..." autocomplete="off">
                    <div id="resultados"></div>
                </div>
                <div class="divsCrearLista" id="CrearLista">
                    <div id="divarribaCrearLista">
                        T√≠tulo: <input type="text" maxlength="50" id="tituloLista">
                    </div>
                    <div id="CancionA√±adida"></div>
                    <div>
                        <button class="CuboBlanco" onclick="CancelarNuevaLista()">Cancelar</button>
                        <button class="CuboBlanco" onclick="GuardarLista()" id="GuardarLista">Guardar</button>
                        <div id="errorLista"></div>
                    </div>
                </div>
                <div class="divsCrearLista" id="MostrarLista">
                    <div id="div_MostrarTituloLista">
                        <span id="MostrarTituloLista"></span>
                    </div>
                    <div id="MostrarMusica"></div>
                    <button onclick="CerrarObservarLista()">Cerrar</button>
                </div>
            </div>
            <button class="CuboBlanco" onclick="ocultarCrearLista()">Cerrar</button>
        </div>
    </div>

    <!-- Ventana para configurar cosas -->
    <div id="ventanaConfiguracion">
        <div id="contenidoConfiguracion">
            <h2>CONFIGURACI√ìN</h2>
            <div style="display: flex; height: 85%; justify-content: space-around; margin-bottom: 2%;">
                <div id="columnaConfiguracion">
                    <button class="btnConfiguracion" onclick="cambiarConfiguaracion(1)">CONTROLES</button>
                    <button class="btnConfiguracion" onclick="cambiarConfiguaracion(2)">COLORES</button>
                </div>
                <div id="aparicionventanasConfiguracion">
                    <div id="configuracion_1" class="divConfiguracion">
                        <div class="divisionConfiguarcion">
                            <h3>Controles de M√∫sica</h3>
                            <table>
                                <tr>
                                    <td>R</td>
                                    <td><button class="btn_controls">‚Ü©Ô∏é</button></td>
                                </tr>
                                <tr>
                                    <td>B</td>
                                    <td><button id="btn_Bucle" class="btn_controls">‚Üª</button></td>
                                </tr>
                                <tr>
                                    <td>(Espacio)</td>
                                    <td><button id="btn_Play" class="btn_controls">‚ùô‚ùô</button></td>
                                </tr>
                                <tr>
                                    <td>S</td>
                                    <td><button id="btn_Continuar" class="btn_controls">‚û§</button></td>
                                </tr>
                            </table>
                        </div>
                        <div class="divisionConfiguarcion">
                            <h3>Controles de Cambio de M√∫sica</h3>
                            <table>
                                <tr>
                                    <td>(flecha izquierda)</td>
                                    <td><button class="btn_controls">‚≠Ö</button></td>
                                </tr>
                                <tr>
                                    <td>(flecha derecha)</td>
                                    <td><button class="btn_controls">‚≠Ü</button></td>
                                </tr>
                            </table>
                        </div>
                        <div class="divisionConfiguarcion">
                            <h3>Controles de Cambio de Pag√≠na</h3>
                            <table>
                                <tr>
                                    <td>(flecha izquierda) + Ctrl</td>
                                    <td><button class="btn_controls">‚èÆ</button></td>
                                </tr>
                                <tr>
                                    <td>(flecha derecha) + Ctrl</td>
                                    <td><button class="btn_controls">‚è≠</button></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div id="configuracion_2" class="divConfiguracion">
                        <table>
                            <tr>
                                <td><button class="btn_musica">Algo</button></td>
                                <td>
                                    <input type="color" value="#000000">
                                    <input type="color" value="#ffffff">
                                    <input type="color" value="#000000">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <button class="CuboBlanco" onclick="ocultarConfiguaracion()">Cerrar</button>
        </div>
    </div>

    <!-- Ventana para navegar -->
    <div id="ventanaNavegador">
        <div id="contenidoNavegador">
            <h2>NAVEGAR</h2>
            <div id="buscadorReproductor">
                <input type="search" id="buscadorPlay" placeholder="Buscar canci√≥n para reproducir..." autocomplete="off" style="width: 50%;">
                <div id="resultadosPlay"></div>
            </div>
            <button class="CuboBlanco" onclick="ocultarNavegador()">Cerrar</button>
        </div>
    </div>



    <script>// Subir audios desde carpeta y guardar en localStorage
        // Cargar lista al iniciar
        Lista = JSON.parse(localStorage.getItem("Lista")) || [];

        document.getElementById("btn-cargar").addEventListener("click", () => {
            document.getElementById("input-folder").click();
        });

        document.getElementById("input-folder").addEventListener("change", async (event) => {
            const files = [...event.target.files];

            const audioFiles = files.filter(file => file.type.startsWith("audio/"));

            const audioArray = [];

            for (const file of audioFiles) {
                const objectURL = URL.createObjectURL(file);
                const duration = await obtenerDuracion(objectURL);

                const modifiedName = file.name.replace(/\.[^.]+$/, "") // Eliminar la extensi√≥n
                                              .replace(/  /g, " / ")  // Reemplazar "  " por " / "
                                              .replace(/_ /g, ": ");

                audioArray.push({
                    nombre: file.name.replace(/\.[^.]+$/, "").replace(/  /g, " / ").replace(/_ /g, ": "),
                    src: "../" + file.name,
                });

                URL.revokeObjectURL(objectURL);
            }

            // üëâ Guardar en localStorage
            localStorage.setItem("Lista", JSON.stringify(audioArray));
        });

        function obtenerDuracion(url) {
            return new Promise(resolve => {
                const audio = document.createElement("audio");
                audio.src = url;
                audio.addEventListener("loadedmetadata", () => {
                    resolve(audio.duration);
                });
            });
        }
    </script> 
    <script>// Poner siguiente canci√≥n autom√°ticamente
        document.getElementById("audio").addEventListener("ended", function () {

            // Si el bucle est√° activado o siguiente desactivado, no avanzar
            if (btn_Lista.Bucle === "on" || btn_Lista.Siguiente === "off") return;

            // Si NO es la √∫ltima canci√≥n
            if (btn_Lista.N_Cancion < Lista.length - 1) {
                btn_Lista.N_Cancion++;

                // Control de paginaci√≥n
                if (btn_Lista.N_Cancion + 1 > btn_Lista.Max) {
                    paginaci√≥n(1);
                }

                reproducirAudio(btn_Lista.N_Cancion);
            } else {
                // Si es la √∫ltima, volver a la primera
                btn_Lista.N_Cancion = 0;
                btn_Lista.Pag = 1;
                btn_Lista.Min = 0;
                btn_Lista.Max = 20;
                paginaci√≥n(2);
                reproducirAudio(btn_Lista.N_Cancion);
            }
        });
    </script>
    <script>// Buscador para crear Lista
        // Funci√≥n que se ejecuta al hacer clic
        function seleccionarElemento(index) {
            const item = Lista[index];
            alert("Seleccionaste: " + item.nombre + "\n√çndice: " + index);
        }

        // ------------------------------------
        // Buscador con botones
        // ------------------------------------
        document.getElementById("buscadorLista").addEventListener("input", function() {
            const texto = this.value.toLowerCase();
            const contenedor = document.getElementById("resultados");
            contenedor.innerHTML = "";

            if (texto.trim() === "") return;

            // Filtrado con √≠ndice real del array
            const filtrados = Lista
                .map((obj, i) => ({ obj, index: i })) // guardamos el √≠ndice
                .filter(item => item.obj.nombre.toLowerCase().includes(texto))
                .slice(0, 40);

            filtrados.forEach(item => {
                const btn = document.createElement("button");
                btn.textContent = item.obj.nombre;

                // onclick enviando el √≠ndice real
                btn.onclick = () => A√±adirCancion(item.index);

                contenedor.appendChild(btn);
            });
        });
    </script>
    <script>// Navegador de canciones
        document.getElementById("buscadorPlay").addEventListener("input", function() {
            const texto = this.value.toLowerCase();
            const contenedor = document.getElementById("resultadosPlay");
            contenedor.innerHTML = "";

            if (texto.trim() === "") return;

            const filtrados = Lista
                .map((obj, i) => ({ obj, index: i }))
                .filter(item => item.obj.nombre.toLowerCase().includes(texto))
                .slice(0, 75);

            filtrados.forEach(item => {
                const btn = document.createElement("button");
                btn.textContent = item.obj.nombre;
                btn_Lista.N_Cancion = item.index
                

                btn.onclick = () => {
                    reproducirAudio(item.index)
                    BuscarPaginaCancion()
                };

                contenedor.appendChild(btn);
            });
        });
    </script>
    <!--
    <script>// Poner siguiente canci√≥n autom√°ticamente de la listas creadas
        document.getElementById("audioLista").addEventListener("endedList", function () {
            // Si el bucle est√° activado o nop esta activo la siguiente canci√≥n, no avanzar a la siguiente
            if (btn_Lista.Bucle_Lista === "on" || btn_Lista.Siguiente_Lista === "off") return;

            // Si NO es la √∫ltima canci√≥n, avanzar
            if (btn_Lista.N_Cancion < Lista.length - 1) {
                btn_Lista.N_Cancion++;

                // Control de paginaci√≥n autom√°tica si cambia de p√°gina
                if (btn_Lista.N_Cancion + 1 > btn_Lista.Max) {
                    paginaci√≥n(1);
                }

                reproducirAudio(btn_Lista.N_Cancion);
            }
            else {
                // Si lleg√≥ a la √∫ltima canci√≥n
                btn_Lista.Play = "off";
                document.getElementById("btn_Play").innerText = "‚ñ∂";
            }
        });
    </script>
    -->
</body>
</html>